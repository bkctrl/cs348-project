<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Salary Bands & Percentiles</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .decile-1, .decile-2 { background-color: #fff3cd; }
    .decile-3, .decile-4 { background-color: #d1ecf1; }
    .decile-5, .decile-6 { background-color: #d4edda; }
    .decile-7, .decile-8 { background-color: #cfe2ff; }
    .decile-9, .decile-10 { background-color: #d1e7dd; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">Salary Bands & Percentiles (R15)</h1>
    
    <!-- Filter Form -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Filter Salary Data</h5>
      </div>
      <div class="card-body">
        <form method="get" action="/salary-bands">
          <div class="row g-3">
            <div class="col-md-4">
              <label for="title" class="form-label">Job Title</label>
              <input 
                type="text" 
                class="form-control" 
                id="title" 
                name="title" 
                placeholder="e.g., Software Engineer Intern"
                value="{{ title or '' }}">
            </div>
            <div class="col-md-4">
              <label for="city" class="form-label">Location/City</label>
              <input 
                type="text" 
                class="form-control" 
                id="city" 
                name="city" 
                placeholder="e.g., Waterloo"
                value="{{ city or '' }}">
            </div>
            <div class="col-md-4">
              <label for="term" class="form-label">Term</label>
              <input 
                type="text" 
                class="form-control" 
                id="term" 
                name="term" 
                placeholder="e.g., Winter 2025"
                value="{{ term or '' }}">
            </div>
          </div>
          <div class="mt-3">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
            <a href="/salary-bands" class="btn btn-outline-secondary">Clear Filters</a>
          </div>
        </form>
      </div>
    </div>

    <!-- Results Section -->
    {% if rows %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Salary Distribution ({{ rows|length }} results)</h5>
          <small class="text-muted">
            Showing percentile ranks and deciles for filtered salary data
          </small>
        </div>
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>#</th>
                <th>Employer</th>
                <th>Title</th>
                <th>Location</th>
                <th>Term</th>
                <th class="text-end">Hourly Rate</th>
                <th class="text-center">Percentile</th>
                <th class="text-center">Decile</th>
              </tr>
            </thead>
            <tbody>
              {% for r in rows %}
                <tr class="decile-{{ r.decile }}">
                  <td>{{ loop.index }}</td>
                  <td><strong>{{ r.employer }}</strong></td>
                  <td><em>{{ r.title }}</em></td>
                  <td>{{ r.location }}</td>
                  <td><span class="badge bg-info">{{ r.term }}</span></td>
                  <td class="text-end">
                    <span class="badge bg-success">${{ "%.2f"|format(r.hourly_rate) }}</span>
                  </td>
                  <td class="text-center">
                    <span class="badge bg-primary">{{ (r.pct_rank * 100)|round|int }}%</span>
                  </td>
                  <td class="text-center">
                    <span class="badge 
                      {% if r.decile <= 3 %}bg-warning
                      {% elif r.decile <= 6 %}bg-info
                      {% else %}bg-success{% endif %}">
                      D{{ r.decile }}
                    </span>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Legend -->
      <div class="card mt-3">
        <div class="card-body">
          <h6 class="card-subtitle mb-2">Understanding the Results:</h6>
          <ul class="mb-0">
            <li><strong>Percentile:</strong> Shows what percentage of salaries fall below this value (e.g., 75% means 75% of salaries are lower)</li>
            <li><strong>Decile:</strong> Groups salaries into 10 equal bands (D1 = bottom 10%, D10 = top 10%)</li>
            <li><strong>Color Coding:</strong> Rows are color-coded by decile for easy visualization</li>
          </ul>
        </div>
      </div>

    {% else %}
      <div class="card">
        <div class="card-body text-center py-5">
          <h3 class="text-muted">No data found</h3>
          <p class="text-muted">
            {% if title or city or term %}
              Try adjusting your filters to see more results.
            {% else %}
              Apply filters above to view salary bands and percentiles.
            {% endif %}
          </p>
        </div>
      </div>
    {% endif %}

    <div class="text-center mt-4">
      <a href="/" class="btn btn-secondary">Back to Home</a>
    </div>
  </div>
</body>
</html>

